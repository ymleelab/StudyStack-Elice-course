<html lang="en" class="h-100">
  <head>
    <%- include('../partials/head'); %>
    <style>
      html,
      body {
        height: 100%;
      }

      body {
        display: flex;
        align-items: center;
        padding-top: 40px;
        padding-bottom: 40px;
        background-color: #f5f5f5;
      }

      .form-signin {
        max-width: 330px;
        padding: 15px;
      }

      .form-signin .form-floating:focus-within {
        z-index: 2;
      }

      .form-signin input[type="username"] {
        margin-bottom: -1px;
        border-bottom-right-radius: 0;
        border-bottom-left-radius: 0;
      }

      .form-signin input[type="password"] {
        margin-bottom: 10px;
        border-top-left-radius: 0;
        border-top-right-radius: 0;
      }
    </style>
  </head>
  <body class="text-center" cz-shortcut-listen="true">
    <main class="form-signin w-100 m-auto">
      <h1 class="h3 mb-3 fw-normal">Please sign in</h1>

      <div class="form-floating">
        <input
          type="username"
          class="form-control"
          id="username"
          placeholder="Username"
        />
        <label for="username">Username</label>
      </div>
      <div class="form-floating">
        <input
          type="password"
          class="form-control"
          id="password"
          placeholder="Password"
        />
        <label for="password">Password</label>
      </div>

      <a class="m-2" href="/auth/signup">Don't have an account?</a>

      <button class="mt-3 w-100 btn btn-lg btn-primary" onclick="login()">
        Login
      </button>
    </main>
    <script>
      function login() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        fetch("/auth/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            username,
            password,
          }),
        }).then((res) => {
          console.log(res.status)
          res.json().then((data) => {
            if (res.status  == 200) {
              console.log(data.token)
              document.cookie = `token=${data.token}; path=/`
              window.location.href = "/"
            } else {
              alert(data.message);
            }
          });
        });
      }
    </script>
  </body>
</html>
